<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Development concept · SeisMonitoring.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SeisMonitoring.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Index</a></li><li class="is-active"><a class="tocitem" href>Development concept</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Process-parallelization"><span>Process parallelization</span></a></li><li><a class="tocitem" href="#Compatible-to-the-other-application"><span>Compatible to the other application</span></a></li></ul></li><li><a class="tocitem" href="../process_parameters/">Processing parameters</a></li><li><a class="tocitem" href="../functions/">Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Development concept</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Development concept</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/kura-okubo/SeisMonitoring.jl/blob/dev_parallel_modified/docs/src/concept.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Development-concept-of-SeisMonitoring.jl"><a class="docs-heading-anchor" href="#Development-concept-of-SeisMonitoring.jl">Development concept of SeisMonitoring.jl</a><a id="Development-concept-of-SeisMonitoring.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Development-concept-of-SeisMonitoring.jl" title="Permalink"></a></h1><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>We have developed <code>SeisMonitoring.jl</code> to perform the TB scale ambient seismic noise processings. The aims of this package are the following:</p><ol><li>Mass downloading the continuous seismic data, removing transient signals, cross-correlations, stacking and measurement of dv/v.</li><li>Options of the processing steps such as the band-pass filtering using the wavelet transform, selective stacking and the dv/v measurement of stretching and MWCS.</li><li>Paralleling the processes using <strong>multi-node</strong> in cluster.</li><li>Optimizing the use of memory and the frequency of I/O.</li></ol><p>The kernels of <code>SeisMonitoring.jl</code> to handle the seismic waveforms are <code>SeisIO.jl</code> and <code>SeisNoise.jl</code>.</p><table><tr><th style="text-align: right">Name</th><th style="text-align: right">Functions</th><th style="text-align: right">Reference</th></tr><tr><td style="text-align: right"><a href="https://seisio.readthedocs.io/en/latest/?badge=latest">SeisIO.jl</a></td><td style="text-align: right">Handle the seismic waveforms</td><td style="text-align: right">Jones, J. P., Okubo, K., Clements, T., and Denolle, M. A. Seisio: a fast, efficient geophysical data architecture for the julia language. Seismol. Res. Lett., 91(4):2368–2377, 2020, doi:<a href="https://pubs.geoscienceworld.org/ssa/srl/article-abstract/91/4/2368/583741/SeisIO-A-Fast-Efficient-Geophysical-Data?redirectedFrom=fulltext">10.1785/0220190295</a>.</td></tr><tr><td style="text-align: right"><a href="https://tclements.github.io/SeisNoise.jl/latest/">SeisNoise.jl</a></td><td style="text-align: right">Tools for ambient seismic noise processings</td><td style="text-align: right">Clements, T. and Denolle, M. A. Seisnoise.jl: ambient seismic noise cross correlation on the cpu and gpu in julia. Seismol. Res. Lett., 92(1):517–527, 2020, doi:<a href="https://pubs.geoscienceworld.org/ssa/srl/article-abstract/92/1/517/591402/SeisNoise-jl-Ambient-Seismic-Noise-Cross?redirectedFrom=fulltext">10.1785/0220200192</a>.</td></tr><tr><td style="text-align: right"></td><td style="text-align: right"></td><td style="text-align: right"></td></tr></table><p>We handle the seismic waveforms using the data structures such as <a href="https://seisio.readthedocs.io/en/latest/src/Help/tutorial.html"><code>SeisIO.SeisData</code></a> and <a href="https://tclements.github.io/SeisNoise.jl/latest/types/#CorrData-Objects-for-ambient-noise-cross-correlations"><code>SeisNoise.CorrData</code></a>, which contains the meta data including the history of applied processes on the data, such as the filtering and tapering, and the waveforms.</p><p>The functions of <code>SeisMonitoring.jl</code> have been developed in the separated packages such as <a href="https://github.com/kura-okubo/SeisDownload.jl"><code>SeisDownload.jl</code></a> for the ease of maintenance of the packages and dependencies, which is suitable for the Julia. However, we decided to merge them into a single package mainly to allow for using all the packages in one line, <code>using SeisMonitoring</code>.</p><p>The dependencies are managed by Julia system, and are listed in Project.toml. We minimized the dependencies, in particular not using the python-related modules and MPI.jl.</p><h2 id="Process-parallelization"><a class="docs-heading-anchor" href="#Process-parallelization">Process parallelization</a><a id="Process-parallelization-1"></a><a class="docs-heading-anchor-permalink" href="#Process-parallelization" title="Permalink"></a></h2><p>Most of the processes are parallelized using Julia-native <code>Distributed.pmap</code> function as the tasks associated with the ambient seismic noise processing can be process parallelized, i.e. asynchronized parallelization by station pairs, days, and frequency bands without the communication across the workers. The <code>pmap</code> allows for the multi-node parallelization. You can perform it by</p><pre><code class="language-julia hljs">using Distributed
NP = 480 # for 56 cores * 10 nodes. Some margins of cores to increase the RAM per core.
addprocs(NP) # Add the workers
print(&quot;After adding the procs: NP=$(nprocs())&quot;);
@everywhere using SeisMonitoring # You need to redefine the packages in all the processors.</code></pre><h3 id="Parallelization-in-computing-cross-correlation"><a class="docs-heading-anchor" href="#Parallelization-in-computing-cross-correlation">Parallelization in computing cross-correlation</a><a id="Parallelization-in-computing-cross-correlation-1"></a><a class="docs-heading-anchor-permalink" href="#Parallelization-in-computing-cross-correlation" title="Permalink"></a></h3><p>The most computationally expensive process is <strong>to compute the cross-correlations.</strong> It is not only due to the number of tasks; <strong>the duplication of the file I/O</strong> needs to be optimized.</p><div class="admonition is-info"><header class="admonition-header">Example of cross-correlation in parallel</header><div class="admonition-body"><p>Let us do the correlations across the stations <code>STA1</code>, <code>STA2</code>, <code>STA3</code> after applying the FFT on the waveforms. Then, the tasks are <code>STA1-STA2</code>, <code>STA1-STA3</code>, <code>STA2-STA3</code>.</p><ul><li>If you read the seismic data or FFT files from the disk in each task, you need to read the <code>STA1</code> twice from the disk. This is redundant, which could cause the damage in the disk.</li><li>The frequency of file I/O is very important to secure the scratch system and disks. See the documentation by TACC <a href="https://docs.tacc.utexas.edu/tutorials/managingio/">https://docs.tacc.utexas.edu/tutorials/managingio/</a> to optimize it.</li><li>So, you want to store all the FFTs in the memory and distribute them to the tasks. However, if you send the FFT from master core hosting the tasks to the workers in the different node, it takes time to transfer the data. You can run this metric, but it is inefficient comparing to conduct the tasks within a node.</li><li>Therefore, we first parallelized the time window e.g. every 2 years, and submitted the jobs separately, and each job executes the cross-correlations of all possible station pairs parallelized with the number of cores in the node. This metric is optimized in the file I/O such that the file of seismic data is accessed only once, and is distributed via the memory within the node.</li><li>It is <strong>not</strong> practical to store the data in a single large file even in the HDF5-based <code>JLD2</code> format. The I/O from a single large file is not recommended when you conduct the process parallelization. Therefore, we separated the seismic data into a daily length, and also output the correlation functions into the small pieces of &#39;.jld2&#39; files, which is gathered in the post-processing.</li></ul></div></div><p>We monitored the usage of CPUs and memory using <a href="https://docs.tacc.utexas.edu/software/remora/">TACC Remora </a>. You can find the case study of scaling of parallelization <a href="https://github.com/kura-okubo/SeisMonitoring_Paper/tree/develop/Appx/Scaling_Frontera">in SeisMonitoring_Paper/Appx/Scaling_Frontera</a>.</p><h2 id="Compatible-to-the-other-application"><a class="docs-heading-anchor" href="#Compatible-to-the-other-application">Compatible to the other application</a><a id="Compatible-to-the-other-application-1"></a><a class="docs-heading-anchor-permalink" href="#Compatible-to-the-other-application" title="Permalink"></a></h2><p>The default file format and processing parameters are tuned to process the data for the High Resolution Seismic Network (HRSN) (doi:<a href="https://ncedc.org/bp_doi_metadata.html">10.7932/HRSN)</a>; however, the work flow can be generalized for any kind of the data set. You can also reuse the internal functions to filter the data. We left the comments and some deprecated functions as the reference for future development.  Please customize the functions under the <a href="https://github.com/kura-okubo/SeisMonitoring.jl/blob/dev_parallel_modified/LICENSE">MIT License</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Index</a><a class="docs-footer-nextpage" href="../process_parameters/">Processing parameters »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Sunday 3 September 2023 16:39">Sunday 3 September 2023</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
